# 開発ルール

- **一括文字列置換は禁止！**
	- **周囲に副次的な影響が無いかを確認しながら、一箇所ずつ変更。**
- 仕様は Docstring に Markdown 形式で記載。
	- Docstring の仕様とコードの実装の間に矛盾があれば、Chat で開発者に確認して修正。
- 後方互換は禁止！古い仕様はすべて削除する
- PowerShell バージョンは `5.1`。アンパサンドによるコマンド連結は禁止。

## 文章ルール

- 既存の文章を無闇に全てを置き換えない。必要な部分だけを追加・修正。
- 文章は必要十分な内容を、簡潔に表現。
- 絵文字は禁止。

## 計画ルール

- 実装・デバッグ・改善（リファクタリング）において、変更が 5ファイル以上と大規模な場合は `dev\*.md` に計画書を作成。

### 計画手順

**以下の手順で目的・検討事項・検討結果・仕様・進捗リストの順に計画書を作成します。**

1. 目的や検討事項に関連するファイルの、モジュール・クラス・メソッド Docstring で既存仕様を確認。
2. 目的や検討事項に矛盾や不明点があれば、Chat で開発者に確認。
3. 検討事項の下調べを `.venv\Scripts\python tmp\*.py` などで実施し、検討事項に検討結果を追記。
4. 検討事項とその結果を元に、仕様を記載。
5. 仕様を元に `## 進捗リスト` セクションを末尾に記載。
	- **進捗項目を適切に分割して、テストファーストな実装手順（テスト・実装・Git コミット）を繰り返す。**
	- 進捗リストは構造化したリストで、項目先頭の `- [ ] ` と `- [x] ` で状態管理。絵文字禁止。
6. Chat エージェントが日本語メッセージで Git コミット。

## 実装ルール

- Python はカレントディレクトリ `${workspaceFolder}` にて `.venv\Scripts\python` で実行。
- **警告の抑制は禁止！根本原因を解決！**
- クラスを使用。グローバルな関数や変数は禁止。
- デザインパターンを活用。
- ログ出力は `logging` を使用。`print` は禁止。
- パス操作は `pathlib` を使用。`os.path` は禁止。
- tkinter では `pack` レイアウトを使用。`grid` や `place` は禁止。

**テスト関連の実装ルール**

- `.venv\Scripts\python -m pytest {$target}` で対象指定テスト。
	- `.\pytest.ini` で `--verbose`, `--tb=short`, `--durations` 指定済み。
- **人の操作や確認を必要とするテストは禁止！**
	- `GuiTestDriver` で tkinter のテストを自動化。
- `.venv\Scripts\python -m pytest` のみのテスト対象を指定しない低速全体テストは禁止。
	- 開発者から低速全体テストの実行指示があった場合のみ実行。
- テストの実装では `EasyImageEdit\test\conftest.py` や、サブフォルダの `conftest.py` を最大限利用。

### 実装手順

**計画書や開発者の指示に基づいて、以下の手順で必ずテストファーストで実装を進めます。**

1. 計画書の進捗リストと仕様を確認し、実装先の Docstring へ適切に仕様を記載。
	- **計画書は計画完了時に破棄するため、Docstring に必要十分な仕様を整備！**
	- モジュールの仕様は `*.py` の先頭、クラスとメソッドの仕様は定義直後に記載。
	- Docstring の内容に """ を含めない。
	- メソッドの仕様は Numpy スタイルの Docstring で記載。
	- 仕様は概念を説明する。コードの例示は禁止。
2. テストを作成し、実行して失敗を確認。
3. 実装を進め、テストを成功させる。
4. `.venv\Scripts\python -m pytest -m "not slow"` の高速全体テストをすべて成功させる。
	- 失敗するテストは実装の対象でなくとも後回しにせずにすぐに修正。
5. 高速全体テストの結果で、実行時間が 0.1秒以上のテストメソッドに `@pytest.mark.slow` を付与。
6. 実装状況に合わせて進捗リストを更新。実装で明らかになった懸念事項や注意点も進捗項目のサブリストに追記。
7. Chat エージェントが日本語メッセージで Git コミット。

## デバッグルール

- 実装ルールに基づいてデバッグする。
- **テストファーストでデバッグ！**
	- テストでバグを再現してから修正することで、バグの想定が正しいかを確認し、バグの再発を防ぐ。

### デバッグ手順

1. バグが再現するテストを実装し、失敗を確認。
2. バグを修正して、テストを成功させる。
3. 高速全体テストをすべて成功させる。
4. 高速全体テストの結果で、実行時間が 0.1秒以上のテストメソッドに `@pytest.mark.slow` を付与。
5. Chat エージェントが日本語メッセージで Git コミット。

## 改善ルール（リファクタリングルール）

- 実装ルールに基づいて改善（リファクタリング）する。
- リファクタリングが大規模なら計画書（進捗リスト）を作成。

### 改善手順（リファクタリング手順）

1. リファクタリング対象のテストの成功を確認。
2. リファクタリングを進め、テストを成功させる。
3. 高速全体テストをすべて成功させる。
4. 高速全体テストの結果で、実行時間が 0.1秒以上のテストメソッドに `@pytest.mark.slow` を付与。
5. **リファクタリングに関連する箇所を広く検索し、Docstring の仕様を更新。**
6. Chat エージェントが日本語メッセージで Git コミット。
